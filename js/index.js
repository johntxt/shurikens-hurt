!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+68}const u=620,c=.125,r=.095,a=c,s=Math.min(c,.18,.235,r,a),f=1.5*u,m=1.5*u+u,l=Object.freeze({t:"NOT_STARTED",o:"IN_PROGRESS",i:"GAME_OVER",u:"READY_FOR_RESET"});function g(n,t=1/0){const e=[];let o=!1;function i(){if(o||0===e.length)return;o=!0;const{m:t,resolve:u,reject:c}=e.shift();Promise.resolve().then((()=>t())).then(u).catch(c).finally((()=>{setTimeout((()=>{o=!1,i()}),n)}))}return function(n){return e.length>=t?Promise.reject(Error("Queue size limit reached")):new Promise(((t,o)=>{e.push({m:n,resolve:t,reject:o}),i()}))}}function d(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function h(n,t,e,o,i){const u=function(n,t,e){return Math.max(Math.min(n,e),t)}(n,t,e);return function(n,t,e,o,i){return(n-t)*(i-o)/(e-t)+o}(u,t,e,o,i)}function p(n){return Math.random()<n}function w(n,t){return Math.random()*(t-n)+n}function M(){return p(.5)}function y(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function v(n){const t=w(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function x(n,t){return n[v(t)]}function b(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function T(n){return n.x+.5*n.width}function _(n){return-n.width<n.x&&n.x<o}function S(n,t){return t/n}function k(n,t,e,o){return n+t*o+.5*e*o*o}function R(n,t,e){return n+t*e}function E(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}function A(n){return E(n).catch(console.error)}async function P(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function j(n,t,e=1,o=1){if("running"===n.state){const i=n.createBufferSource();i.buffer=t,i.playbackRate.value=e;const u=n.createGain();u.gain.value=o,i.connect(u),u.connect(n.destination),i.start()}}function O(n,t,e,o,i,u,c=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*u),n.scale(c,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-u,i,u),n.restore()}const I="high-score";function N(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function F(){z().forEach(L),H().forEach(G),q().forEach(G),function(){const n=U();G(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".loading").classList.add("loading--completed")}function X(n){z().forEach(G),H().forEach(L),q().forEach(G),J().textContent=n}function D(n,t){z().forEach(G),H().forEach(G),q().forEach(L),function(){const n=$();G(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".game__result-score").textContent=n,document.querySelector(".game__result-best").textContent=t}function C(n){const t=document.querySelector(".game__canvas-container");t.classList.add("game__canvas-container--bg-"+n),setTimeout((()=>{t.classList.remove(...[0,1,2,3].map((n=>"game__canvas-container--bg-"+n))),B().style.backgroundImage=`url('../img/background-${n}.png')`}),2e3)}function Y(n){const[t,e]=N(),o=[U(),$()],u=t/n.width,c=e/n.height;o.forEach((t=>{const o=n.width/2+20,r=i(n)-16;t.style.left=o*u+"px",t.style.bottom=e-r*c+"px"}))}function G(n){n.style.visibility="hidden"}function L(n){n.style.visibility="visible"}function V(){document.querySelector(".loading__text").textContent=y(["Gathing carrots...","Planting carrots...","Sharpening shurikens...","Pulling weeds..."])}function z(){return[document.querySelector(".game__title"),document.querySelector(".info-button"),U()]}function H(){return[J()]}function q(){return[document.querySelector(".game__result"),$()]}function B(){return document.querySelector(".game__canvas")}function J(){return document.querySelector(".game__score")}function U(){return document.querySelector(".game__start-hint")}function $(){return document.querySelector(".game__reset-hint")}const Q=20,K=20,W=Math.floor(o/2)-Q/2,Z=8*(o/3)/(u*u),nn=-u*Z/2,tn=2.6,en=2.6,on=-6,un=0,cn=1,rn=2,an=3,sn=4,fn=.7,mn=nn,ln=2*Math.abs(mn)/Z,gn=250,dn=3e3,hn=180;function pn(){return{l:rn,h:tn,p:en,M:0,width:Q,height:K,x:W,y:-K*en,velocityY:0,v:!0,T:0,isFrozen:!0,_:0}}function wn(n){return i(n)-K}function Mn(n){return n.S.y===wn(n)}function yn(n){n.status!==l.o||n.S.v||(n.S.velocityY=nn,n.S.l=rn,n.S.v=!0,n.S.T=n.k,j(n.R,y(n.P.A)))}function vn(n){n.S.isFrozen||(n.status===l.t||n.status===l.o?(n.S.v&&(xn(n),function(n){const t=n.k-n.S.T,e=h(t,0,u,0,1),o=h(e,.23,.9,0,2*Math.PI);n.S.M=o}(n),bn(n),function(n){n.S.j&&!n.S.v&&(yn(n),n.S.j=!1)}(n)),function(n){if(!n.S.v){const e=n.O.filter((n=>!n.I&&_(n)));if(e.length>0){const o=T(n.S),i=(t=o,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(e,(n=>Math.abs(T(n)-t)))),u=n.S.h<0!==i.N;n.S.h*=u?-1:1}}var t}(n)):n.status===l.i&&(xn(n),function(n){const t=n.k-n.S._,e=h(t,0,ln,0,1),o=h(e,.35,.75,0,-.5*Math.PI);n.S.M=o}(n),bn(n)))}function xn(n){var t,e,o;n.S.velocityY=(t=n.S.velocityY,e=Z,o=n.F,t+e*o),n.S.y=k(n.S.y,n.S.velocityY,Z,n.F)}function bn(n){(function(n){return n.S.y>wn(n)})(n)&&(n.S.y=wn(n),n.S.velocityY=0,n.S.v=!1,n.S.l=un,n.S.M=0,n.status===l.i&&(n.S.l=sn))}function Tn(n){const t=w(gn,dn);n.X=setTimeout((()=>{n.S.v||(n.S.l=cn),n.X=setTimeout((()=>{n.S.v||(n.S.l=un),Tn(n)}),hn)}),t)}function _n(n){n.S.velocityY=mn,n.S.l=an,n.S.M=0,n.S._=n.k,function(n){clearTimeout(n.X)}(n)}const Sn=10,kn=10,Rn=2.5,En=2.5,An=Sn*Rn*.5,Pn=.4,jn=3,On=1,In=.2,Nn=.7;function Fn(n){return function(n,t){const e=i(n)-K/2-kn/2,u=n.D?a:r,c=S(An,u)*Pn;return{h:Rn,p:En,M:0,C:t?c:-c,width:Sn,height:kn,x:t?-Sn:o,y:e,velocityX:t?u:-u,N:t,I:!1}}(n,M())}function Xn(n,t){if(n.status!==l.o)return;if(!p(n.D?Nn:In))return;const e=Fn(n),o=function(n,t,e){const o=n+(t-n)*e,i=Math.random();return i<e?n+Math.sqrt(i*(t-n)*(o-n)):t-Math.sqrt((1-i)*(t-n)*(t-o))}(-f,m,.5);e.Y=t-W/Math.abs(e.velocityX)+o,e.Y<n.k?console.error("Cannot create future snack in the past. This should never happen. The caller has provided a jumpTime that is NOT far enough into the future."):n.G.push(e)}const Dn=10,Cn=10,Yn=W/s+f,Gn=2,Ln=2,Vn=.4,zn=Dn*Gn*.5,Hn=[{l:0,velocityX:c,L:.85},{l:1,velocityX:.18,L:.95},{l:2,velocityX:.235,L:1.1}],qn=[.45,.35,.2],Bn=50,Jn=.8,Un=.25,$n=.6,Qn=60;function Kn(n){return i(n)-K/2-Cn/2}function Wn(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,u=i*i-4*o*-n;if(u<0)return null;{const n=Math.sqrt(u);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(Kn(n)-(wn(n)+K),nn,Z))}function Zn(n){if(n.status!==l.o)return;const t=n.V.filter((t=>t.Y<=n.k));var e,o,i;n.V=n.V.filter((t=>t.Y>n.k)),n.O.push(...t),e=()=>{!function(n,t){const e=y(n.P.H),o=Math.max(...t.map((n=>n.L))),i=w(-.05,.05),u=o+i;j(n.R,e,u,$n)}(n,t)},o=Qn,(i=t.length)>0&&function n(t){e(t),t+1<i&&setTimeout((()=>n(t+1)),o)}(0)}function nt(n){const t=function(n){function t(n){return n<1e4?[.1,.3,.6]:n<25e3?[.45,.4,.15]:n<4e4?[.65,.3,.05]:[.9,.1,0]}const e=[1*u,2.5*u,3.5*u],o=[2.5*u,3.5*u,7*u],i=v(t(n));return w(e[i],o[i])}(n.k-n.q);n.B=setTimeout((()=>{if(n.status!==l.o)return;const t=n.k+Yn;!function(n,t){const e=(f=n.k-n.q,f<7e3?1+v([.9,.1]):f<15e3?1+v([.7,.2,.05,.05]):f<3e4?1+v([.5,.2,.1,.1]):1+v([.4,.2,.15,.15,.05,.05])),i=function(n){const t=M(),e=x(Hn,qn).velocityX;return d(n,(()=>{const o=p(Math.pow(Jn,1/n))?t:!t,i=p(Math.pow(Un,1/n))?e:x(Hn,qn).velocityX;return o?i:-i}))}(e),u=(s=i,s.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map)),c=new Map(i.map((e=>[e,tt(n,t,e)]))),r=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(c,((n,[t,e])=>[n,function(n,t,e,o){const i=Math.floor((t-n)/o)+1,u=Math.min(e,i),c=function(n){const t=n.slice();for(let n=t.length-1;n>=0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t}(d(i,(n=>n))).slice(0,u).sort(((n,t)=>n-t));if(0===c.length)return[];const r=c[0],a=c[c.length-1],s=w(0,t-n-(a-r)*o);return c.map((t=>n+(t-r)*o+s))}(t,e,u.get(n),(Dn*Gn+2)/Math.abs(n))])),a=Array.from(r,(([t,e])=>e.map((e=>function(n,t,e){const i=Hn.find((n=>Math.abs(e)===n.velocityX)),u=e>=0,c=S(zn,e)*Vn;return{Y:t,l:i.l,h:Gn,p:Ln,M:0,C:c,width:Dn,height:Cn,x:u?-Dn:o,y:Kn(n),velocityX:e,N:u,I:!1,L:i.L}}(n,e,t))))).flat();var s;var f;n.J.push(t),n.V.push(...a)}(n,t),Xn(n,t),nt(n)}),t)}function tt(n,t,o){const i=Bn+e,c=Wn(n),r=t+u-c-i,a=W+Q+Dn;return[t+c+i-W/Math.abs(o),r-a/Math.abs(o)]}const et=3,ot=400,it=800,ut=60;function ct(n){C(n.U),Y(n),F(),Tn(n),setTimeout((()=>{n.S.isFrozen=!1}),2e3)}function rt(i){for(let n=i.$;n>0;n-=e)i.F=Math.min(n,e),i.k+=i.F,at(i),i.K+=1;i.W+=1,i.Z-i.nn>=1e3&&(i.tn=i.W,i.en=i.K,i.W=0,i.K=0,i.nn=i.Z),function(e){(function(n){n.un.clearRect(0,0,o,n.height)})(e),function(n){O(n.un,n.images.S[n.S.l],n.S.x,n.S.y+on,n.S.width,n.S.height,n.S.h,n.S.p,n.S.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(n.S.x,n.S.y,Q,K))}(e),function(n){for(const e of n.rn)O(n.un,n.images.an,e.x,e.y,e.width,e.height,e.h,e.p,e.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.O)O(n.un,n.images.sn[e.l],e.x,e.y,e.width,e.height,e.h,e.p,e.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(e.x,e.y,Dn,Cn))}(e),function(n){n.fn>0&&(n.un.fillStyle=`rgba(255, 255, 255, ${n.fn})`,n.un.fillRect(0,0,o,n.height))}(e),function(e){if(e.cn){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.tn)+" F/S",Math.round(e.en)+" U/S"].filter(Boolean).join("   ");e.un.font=n,e.un.fillStyle=t,e.un.fillText(i,8,e.height-8),e.un.strokeStyle=t,e.un.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.$=n-i.Z,i.Z=n,rt(i)}))}function at(n){!function(n){const t=n.J.length>0&&n.J[0]<=n.k;n.mn&&t&&(yn(n),n.J.shift())}(n),vn(n),Zn(n),function(n){if(n.status!==l.o)return;const t=n.G.filter((t=>t.Y<=n.k)).filter((t=>{const e=(Sn*Rn+4)/Math.abs(t.velocityX),o=[...n.O,...n.V].filter((n=>Math.abs(n.velocityX-t.velocityX)<Number.EPSILON));return[...n.rn,...o].every((n=>Math.abs(t.Y-n.Y)>=e))}));n.G=n.G.filter((t=>t.Y>n.k)),n.rn.push(...t)}(n),function(n){for(const t of n.O)t.x=k(t.x,t.velocityX,0,n.F),t.M=R(t.M,t.C,n.F)}(n),function(n){for(const t of n.rn)t.x=k(t.x,t.velocityX,0,n.F),t.M=R(t.M,t.C,n.F)}(n),function(n){const t=n.ln;(function(n){if(n.D)return;if(n.status!==l.o)return;const t=n.O.filter((n=>{const t=!n.I,e=n.N&&n.x>W+Q,o=!n.N&&n.x+Dn<W;return t&&(e||o)}));t.forEach((n=>n.I=!0)),n.ln+=t.length})(n),function(n){if(n.status!==l.o)return;const t=n.D?On:jn,e=n.rn.filter((t=>{const e=!t.I,o=b(n.S,t);return e&&o}));e.forEach((n=>n.I=!0)),n.rn=n.rn.filter((n=>!e.includes(n))),n.ln+=e.length*t}(n);const e=n.ln-t;for(let o=0;o<e;o++)n.gn((()=>{n.status===l.o&&(j(n.R,y(n.P.ln)),X(t+o+1))}))}(n),function(n){n.status===l.o?function(n){for(const t of n.O)if(b(n.S,t))return!0;return!1}(n)&&(!function(n){n.ln>n.dn&&(n.dn=n.ln,t=n.ln,localStorage.setItem(I,t));var t}(n),function(n){clearTimeout(n.B)}(n),function(n){n.fn=1}(n),_n(n),n.status=l.i,j(n.R,n.P.hn)):n.status===l.i&&function(n){return 0===n.O.length&&0===n.rn.length}(n)&&(n.status=l.u,D(n.ln,n.dn))}(n),function(n){n.O=n.O.filter(_)}(n),function(n){n.rn=n.rn.filter(_)}(n),function(n){n.status===l.t&&Mn(n)&&!n.pn?n.pn=setTimeout((()=>{n.status===l.t&&(!function(){const n=U();L(n),n.classList.add("spawn-and-shrug-bubble")}(),j(n.R,y(n.P.ln)))}),it):n.status!==l.u||n.wn||(n.wn=setTimeout((()=>{n.status===l.u&&(!function(){const n=$();L(n),n.classList.add("spawn-and-shrug-bubble")}(),j(n.R,y(n.P.ln)))}),it))}(n),function(n){n.fn>0&&(n.fn-=n.F/ot,n.fn<0&&(n.fn=0))}(n)}async function st(n){await async function(n){"suspended"!==n.R.state||n.Mn||await n.R.resume()}(n),function(n){n.status===l.t&&Mn(n)?(n.status=l.o,n.q=n.yn??n.k,nt(n),X(n.ln)):n.status===l.u&&(n.status=l.t,n.S=pn(),n.O=[],n.V=[],n.rn=[],n.G=[],n.J=[],n.ln=0,n.U=(n.U+1)%et,n.pn=null,n.wn=null,ct(n))}(n),yn(n),function(n){const t=n.k-n.S.T;n.status===l.o&&t>u*fn&&(n.S.j=!0)}(n)}function ft(n,t,e){const o=n.height,[u,c]=mt(t,e);n.width=u,n.height=c,function(n){n.rn.map((t=>{t.y=i(n)-K/2-kn/2}))}(n),function(n){n.O.map((t=>{t.y=Kn(n)}))}(n),function(n,t){const e=i({height:t}),o=n.S.y,u=i(n);n.S.y=u-(e-o)}(n,o),Y(n)}function mt(n,t){return[o,o*t/n]}function lt(n){n.stopPropagation()}function gt(n,t){const[e,i]=N(),u=Math.floor(e*window.devicePixelRatio),c=Math.floor(i*window.devicePixelRatio),r=u/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(u),n.height=Math.floor(c),n.getContext("2d").scale(r,r),t&&ft(t,n.width,n.height)}window.addEventListener("DOMContentLoaded",(async function(){const n=performance.now();V();const t=setInterval(V,800),e=B(),o=document.querySelector(".info-button"),i=document.querySelector(".info-modal"),u=document.querySelector(".info-modal__card"),c=e.getContext("2d"),r=new AudioContext,{P:a,images:s}=await async function(n){const t={A:[],ln:[],H:[]},e=[P(n,"./sfx/die.mp3").then((n=>t.hn=n)),P(n,"./sfx/eat.wav").then((n=>t.vn=n)),P(n,"./sfx/jump-0.mp3").then((n=>t.A[0]=n)),P(n,"./sfx/jump-1.mp3").then((n=>t.A[1]=n)),P(n,"./sfx/jump-2.mp3").then((n=>t.A[2]=n)),P(n,"./sfx/jump-3.mp3").then((n=>t.A[3]=n)),P(n,"./sfx/jump-4.mp3").then((n=>t.A[4]=n)),P(n,"./sfx/jump-5.mp3").then((n=>t.A[5]=n)),P(n,"./sfx/score-0.wav").then((n=>t.ln[0]=n)),P(n,"./sfx/score-1.wav").then((n=>t.ln[1]=n)),P(n,"./sfx/score-2.wav").then((n=>t.ln[2]=n)),P(n,"./sfx/score-3.wav").then((n=>t.ln[3]=n)),P(n,"./sfx/shoot-0.wav").then((n=>t.H[0]=n)),P(n,"./sfx/shoot-1.wav").then((n=>t.H[1]=n))],o={S:[],sn:[],background:[]},i=[E("./img/player-0.png").then((n=>o.S[0]=n)),E("./img/player-1.png").then((n=>o.S[1]=n)),E("./img/player-2.png").then((n=>o.S[2]=n)),E("./img/player-3.png").then((n=>o.S[3]=n)),E("./img/player-4.png").then((n=>o.S[4]=n)),E("./img/enemy-0.png").then((n=>o.sn[0]=n)),E("./img/enemy-1.png").then((n=>o.sn[1]=n)),E("./img/enemy-2.png").then((n=>o.sn[2]=n)),E("./img/snack.png").then((n=>o.an=n)),A("./img/background-0.png"),A("./img/background-1.png"),A("./img/background-2.png")];return await Promise.all([...e,...i]),{P:t,images:o}}(r),f=new URL(location),m="true"===f.searchParams.get("auto"),d="true"===f.searchParams.get("debug"),h="true"===f.searchParams.get("skip"),p="true"===f.searchParams.get("mute"),w="false"===f.searchParams.get("hungry"),M=f.searchParams.get("start"),y=f.searchParams.get("score"),v=f.searchParams.get("background"),x=M?Number.parseInt(M):void 0,b=y?Number.parseInt(y):0,T=v?Number.parseInt(v):0,_=localStorage.getItem(I)??0,[S,k]=N(),R=function(n,t,e,o,i,u,c,r,a,s,f,m,d,h){const[p,w]=mt(i,u);return{mn:r,cn:a,Mn:s,D:f,yn:m,un:n,R:t,P:e,images:o,width:p,height:w,Z:0,$:0,k:0,F:0,tn:0,W:0,en:0,K:0,nn:0,status:l.t,ln:d,dn:c,S:pn(),O:[],V:[],rn:[],G:[],J:[],q:0,gn:g(ut),xn:null,B:null,X:null,pn:null,wn:null,fn:0,U:h}}(c,r,a,s,S,k,_,m,d,p,!w,x,b,T),j=performance.now()-n;setTimeout((()=>{!function(n,t,e,o,i,u){gt(e),L(e),ct(n),requestAnimationFrame((t=>{n.$=0,n.Z=t,rt(n)})),window.addEventListener("resize",(()=>gt(e,n)),{passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await st(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(n)),document.addEventListener("keydown",function(n){return t=>{"Escape"===t.key&&G(n)}}(i),{passive:!0}),document.addEventListener("visibilitychange",function(n,t){return()=>{!function(n,t){document.hidden?n.suspend():t.Mn||n.resume()}(n,t)}}(t,n)),e.addEventListener("pointerup",function(n,t){async function e(){await st(t),n.addEventListener("pointerdown",o,{passive:!0})}async function o(){await st(t)}return e}(e,n),{once:!0,passive:!0}),o.addEventListener("click",function(n){function t(){L(n)}return t}(i),{passive:!0}),i.addEventListener("click",function(n){function t(){G(n)}return t}(i),{passive:!0}),u.addEventListener("click",lt,{passive:!0})}(R,r,e,o,i,u),clearInterval(t)}),h?0:Math.max(1500-j,0))}))}();
